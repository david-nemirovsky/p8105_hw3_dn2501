---
title: "Homework 3"
author: "David Nemirovsky"
date: "10/10/2020"
output: github_document
---

```{r setup, include = FALSE}
library(tidyverse)
library(p8105.datasets)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 1

Load the instacart dataset:

```{r}
data("instacart")
```

This dataset contains `r nrow(instacart)` rows and `r ncol(instacart)` columns. There are user and order variables such as user ID, order ID, order day, and order hour. There are also item variables such as name, aisle, department, and numeric code.

How many aisles, and which are the most items from?

```{r counting aisles, results = 'hide'}
instacart %>% 
  count(aisle) %>% 
  arrange(desc(n))
```

Let's make a plot:

```{r ggplot of items ordered in each aisle}
instacart %>% 
  count(aisle) %>% 
  filter(n > 10000) %>% 
  mutate(
    aisle = factor(aisle),
    aisle = fct_reorder(aisle,n)
  ) %>% 
  ggplot(aes(x = aisle, y = n)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

Let's make a table:

```{r table for specific aisles}
instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
  group_by(aisle) %>% 
  count(product_name) %>% 
  mutate(rank = min_rank(desc(n))) %>% 
  filter(rank < 4) %>% 
  arrange(aisle, rank) %>% 
  knitr::kable()
```

Apples vs Ice Cream:

```{r table for specific products vs day of week}
instacart %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  group_by(product_name, order_dow) %>% 
  summarize(mean_hour = mean(order_hour_of_day)) %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour)
```

## Problem 2

Load and tidy the accelerometer dataset:

```{r load and tidy accel data, message = FALSE}
accel_df = 
  read_csv("./data/accel_data.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    activity_1:activity_1440,
    names_to = "minute", 
    names_prefix = "activity.", 
    values_to = "activity"
  ) %>% 
  mutate(
    day_type = case_when(
      day %in% c("Saturday", "Sunday") ~ "weekend",
      day %in% c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday") ~ "weekday")
    ) %>% 
  relocate(week, day_type) %>% 
  mutate(
    week = factor(week), 
    day_type = factor(day_type), 
    day = factor(day))
```

The `accel_df` dataset contains `r nrow(accel_df)` rows and `r ncol(accel_df)` columns. It shows the activity of a 63-year-old male with a BMI of 25 diagnosed with congestive heart failure over the course of 5 weeks, with activity observations recorded every minute over this time period. The variables included are week, type of day, some day ID, day, minute, and amount of activity done throughout each minute recorded.

Create a table for total activity for each day:

```{r total activity table, message =  FALSE}
accel_df %>% 
  group_by(week, day) %>% 
  summarize(total_activity = sum(activity)) %>% 
  knitr::kable(digits = 0)
```

According to the table, this 63-year-old appeared to be most active on Fridays, in general. His activity seemed relatively uniform for all other days, however it is important to note that in the last two Saturdays (Weeks 4 and 5), he recorded the lowest amount of activity possible. Maybe he did not wear his accelerometer at all those days, or he just wasn't active at all, with the former being more likely.

